function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}define(["jquery","TYPO3/CMS/Backend/Icons","TYPO3/CMS/Backend/Modal","./AreaEditor","TYPO3/CMS/Backend/FormEngineValidation","jquery-ui/draggable"],function(u,h,f,a,i){"use strict";return function(){function t(){_classCallCheck(this,t),_defineProperty(this,"trigger",null),_defineProperty(this,"currentModal",null),_defineProperty(this,"areaEditor",null),_defineProperty(this,"image",null),_defineProperty(this,"buttonAddRect",null),_defineProperty(this,"buttonAddCircle",null),_defineProperty(this,"buttonAddPoly",null),_defineProperty(this,"buttonDismiss",null),_defineProperty(this,"buttonSave",null),_defineProperty(this,"configuration",null),this.initializeTrigger()}return _createClass(t,[{key:"initializeTrigger",value:function(){u(".t3js-area-wizard-trigger").off("click").on("click",this.triggerHandler.bind(this))}},{key:"triggerHandler",value:function(t){t.preventDefault(),this.trigger=u(t.currentTarget),this.show()}},{key:"show",value:function(){var e=this,i=this.trigger.data("modalTitle"),n=this.trigger.data("buttonAddrectText"),a=this.trigger.data("buttonAddcircleText"),r=this.trigger.data("buttonAddpolyText"),o=this.trigger.data("buttonDismissText"),s=this.trigger.data("buttonSaveText"),d=this.trigger.data("url"),l=this.trigger.data("payload"),c=this.initialize.bind(this);h.getIcon("spinner-circle",h.sizes.default,null,null,h.markupIdentifiers.inline).done(function(t){e.currentModal=f.advanced({additionalCssClasses:["modal-area-wizard"],buttons:[{btnClass:"btn-default pull-left button-add-rect",icon:"extensions-imagemap-rect",text:n},{btnClass:"btn-default pull-left button-add-circle",icon:"extensions-imagemap-circle",text:a},{btnClass:"btn-default pull-left button-add-poly",icon:"extensions-imagemap-poly",text:r},{btnClass:"btn-default button-dismiss",icon:"actions-close",text:o},{btnClass:"btn-primary button-save",icon:"actions-document-save",text:s}],callback:function(e){u.post({url:d,data:l}).done(function(t){e.find(".t3js-modal-body").append(t).addClass("area-editor"),c()})},content:u('<div class="modal-loading">').append(t),size:f.sizes.full,style:f.styles.dark,title:i}),e.currentModal.on("hide.bs.modal",function(){e.destroy()}),e.currentModal.data("bs.modal").options.backdrop="static"})}},{key:"initialize",value:function(){var r=this;this.image=this.currentModal.find(".image img"),this.configuration=this.currentModal.find(".picture").data("configuration");var t=this.currentModal.find(".picture").data("scale-factor"),e=parseInt(this.image.css("width")),i=parseInt(this.image.css("height")),n={canvas:{width:e,height:i,top:-1*i},browseLinkUrlAjaxUrl:window.TYPO3.settings.ajaxUrls.imagemap_browselink_url};this.buttonAddRect=this.currentModal.find(".button-add-rect").off("click").on("click",this.buttonAddRectHandler.bind(this)),this.buttonAddCircle=this.currentModal.find(".button-add-circle").off("click").on("click",this.buttonAddCircleHandler.bind(this)),this.buttonAddPoly=this.currentModal.find(".button-add-poly").off("click").on("click",this.buttonAddPolyHandler.bind(this)),this.buttonDismiss=this.currentModal.find(".button-dismiss").off("click").on("click",this.buttonDismissHandler.bind(this)),this.buttonSave=this.currentModal.find(".button-save").off("click").on("click",this.buttonSaveHandler.bind(this)),this.areaEditor=new a(n,"modal-canvas","#areasForm"),function(t){r.areaEditor.setScale(t);var e=r,i=u("#magnify"),n=i.find(".zoomout"),a=i.find(".zoomin");t<1&&(a.removeClass("hide"),a.click(function(){e.areaEditor.setScale(1),a.hide(),n.show()}),n.click(function(){e.areaEditor.setScale(t),n.hide(),a.show()}))}(t),this.areaEditor.initializeAreas(this.configuration.existingAreas)}},{key:"destroy",value:function(){this.currentModal&&(this.currentModal=null,this.areaEditor=null)}},{key:"buttonAddRectHandler",value:function(t){t.stopPropagation(),t.preventDefault();var e=parseInt(this.image.css("width")),i=parseInt(this.image.css("height"));this.areaEditor.addRect({coords:e/2-50+","+(i/2-50)+","+(e/2+50)+","+(i/2+50)})}},{key:"buttonAddCircleHandler",value:function(t){t.stopPropagation(),t.preventDefault();var e=parseInt(this.image.css("width")),i=parseInt(this.image.css("height"));this.areaEditor.addCircle({coords:e/2+","+i/2+",50"})}},{key:"buttonAddPolyHandler",value:function(t){t.stopPropagation(),t.preventDefault();var e=parseInt(this.image.css("width")),i=parseInt(this.image.css("height"));this.areaEditor.addPoly({coords:e/2+","+(i/2-50)+","+(e/2+50)+","+(i/2+50)+","+e/2+","+(i/2+70)+","+(e/2-50)+","+(i/2+50)})}},{key:"buttonDismissHandler",value:function(t){t.stopPropagation(),t.preventDefault(),this.currentModal.modal("hide")}},{key:"buttonSaveHandler",value:function(t){t.stopPropagation(),t.preventDefault();var e=u('input[name="'.concat(this.configuration.itemName,'"]'));e.val(this.areaEditor.toAreaXml()).trigger("imagemap:changed"),i.markFieldAsChanged(e),this.currentModal.modal("hide")}}]),t}()});
//# sourceMappingURL=EditControl.js.map
