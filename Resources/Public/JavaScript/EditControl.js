function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}define(["jquery","TYPO3/CMS/Backend/Icons","TYPO3/CMS/Backend/Modal","./AreaEditor","jquery-ui/draggable","jquery-ui/resizable"],function(c,u,h,d){"use strict";return function(){function t(){_classCallCheck(this,t),_defineProperty(this,"trigger",null),_defineProperty(this,"currentModal",null),_defineProperty(this,"areaEditor",null),this.initializeTrigger()}return _createClass(t,[{key:"initializeTrigger",value:function(){c(".t3js-area-wizard-trigger").off("click").on("click",this.triggerHandler.bind(this))}},{key:"triggerHandler",value:function(t){t.preventDefault(),this.trigger=c(t.currentTarget),this.show()}},{key:"show",value:function(){var e=this,i=this.trigger.data("modalTitle"),a=this.trigger.data("buttonAddrectText"),n=this.trigger.data("buttonAddcircleText"),r=this.trigger.data("buttonAddpolyText"),s=this.trigger.data("buttonSubmitText"),o=this.trigger.data("url"),l=this.trigger.data("payload"),d=this.init.bind(this);u.getIcon("spinner-circle",u.sizes.default,null,null,u.markupIdentifiers.inline).done(function(t){e.currentModal=h.advanced({additionalCssClasses:["modal-area-wizard"],buttons:[{btnClass:"btn-default pull-left",dataAttributes:{method:"addRect"},icon:"extensions-imagemap-rect",text:a},{btnClass:"btn-default pull-left",dataAttributes:{method:"addCircle"},icon:"extensions-imagemap-circle",text:n},{btnClass:"btn-default pull-left",dataAttributes:{method:"addPoly"},icon:"extensions-imagemap-poly",text:r},{btnClass:"btn-primary",dataAttributes:{method:"save"},icon:"actions-document-save",text:s}],callback:function(e){c.post({url:o,data:l}).done(function(t){e.find(".t3js-modal-body").html(t),d()})},content:c('<div class="modal-loading">').append(t),size:h.sizes.full,style:h.styles.dark,title:i}),e.currentModal.on("hide.bs.modal",function(){e.destroy()}),e.currentModal.data("bs.modal").options.backdrop="static"})}},{key:"init",value:function(){var t=c(".modal-panel-main .image img"),e=c(".modal-panel-main .picture"),i=e.data("configuration"),a={canvas:{width:parseInt(t.css("width")),height:parseInt(t.css("height")),top:-1*parseInt(t.css("height"))},browseLinkUrlAjaxUrl:window.TYPO3.settings.ajaxUrls.imagemap_browselink_url},n=new d(a,"modal-canvas","#areasForm");this.areaEditor=n;var r,s,o,l;r=e.data("scale-factor"),s=c("#magnify"),o=s.find(".zoomout"),l=s.find(".zoomin"),n.setScale(),r<1&&(l.removeClass("hide"),l.click(function(){n.setScale(1),l.hide(),o.show()}),o.click(function(){n.setScale(r),o.hide(),l.show()})),c("#addRect").on("click",function(){n.addRect({coords:parseInt(t.css("width"))/2-50+","+(parseInt(t.css("height"))/2-50)+","+(parseInt(t.css("width"))/2+50)+","+(parseInt(t.css("height"))/2+50)})}),c("#addCircle").on("click",function(){n.addCircle({coords:parseInt(t.css("width"))/2-50+","+(parseInt(t.css("height"))/2-50)+",50"})}),c("#addPoly").on("click",function(){n.addPoly({coords:parseInt(t.css("width"))/2+","+(parseInt(t.css("height"))/2-50)+","+(parseInt(t.css("width"))/2+50)+","+(parseInt(t.css("height"))/2+50)+","+parseInt(t.css("width"))/2+","+(parseInt(t.css("height"))/2+70)+","+(parseInt(t.css("width"))/2-50)+","+(parseInt(t.css("height"))/2+50)})}),c("#submit").on("click",function(){window.opener.$('input[name="'+i.itemName+'"]').val(n.toAreaXml()).trigger("imagemap:changed"),close()}),n.initializeAreas(i.existingAreas)}},{key:"destroy",value:function(){this.currentModal&&(this.currentModal=null,this.data=null)}}]),t}()});
//# sourceMappingURL=EditControl.js.map
