{"version":3,"sources":["AreaEditor.es6"],"names":["define","$","fabric","Aggregation","baseClass","mixins","base","args","forEach","mixin","copyProperties","target","source","Object","getOwnPropertyNames","concat","getOwnPropertySymbols","property","match","defineProperty","getOwnPropertyDescriptor","prototype","AreaFormElement","subForm","coordForm","id","__uid","initializeValues","initializeButtons","initializeColorPicker","keys","htmlElements","key","getFormElement","getElements","field","style","backgroundColor","color","value","width","left","height","top","bind","button","addEventListener","colorPicker","getElement","colors","cell","document","createElement","classList","add","colorPickerAction","appendChild","event","editorForm","openPopup","currentTarget","deleteArea","remove","showElement","hideElement","set","AreaEditor","hexToRgbA","rgbAToHex","editor","canvas","renderAll","selector","template","element","querySelector","innerHTML","replace","DOMParser","parseFromString","body","firstChild","querySelectorAll","shape","getAreaCoords","getAdditionalAttributes","getLink","join","result","ignoreAttributes","indexOf","push","length","Rect","Circle","coords","getCoords","x","radius","y","Polygon","AreaForm","formElement","area","initializeHtmlElements","areas","insertBefore","postAddToForm","currentArea","link","blur","data","window","imagemap","browseLink","objectId","currentValue","ajax","url","TYPO3","settings","ajaxUrls","context","done","response","vHWin","open","focus","xml","toAreaXml","form","options","preview","initializeOptions","Canvas","option","hasOwnProperty","scaling","parseInt","scaleFactor","configuration","split","right","bottom","hasRotatingPoint","borderColor","stroke","strokeWidth","fill","addArea","coordsXY","i","points","Error","xy","Math","min","hex","alpha","chars","r","g","b","test","substring","rgba","numbers","rgb","toString","slice","toUpperCase"],"mappings":"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","file":"AreaEditor.js","sourcesContent":["define(['jquery', 'TYPO3/CMS/Imagemap/Fabric'], ($, fabric) => {\n\tlet Aggregation = (baseClass, ...mixins) => {\n\t\tclass base extends baseClass {\n\t\t\tconstructor (...args) {\n\t\t\t\tsuper(...args);\n\t\t\t\tmixins.forEach((mixin) => {\n\t\t\t\t\tcopyProperties(this, (new mixin));\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// this function copies all properties and symbols, filtering out some special ones\n\t\tlet copyProperties = (target, source) => {\n\t\t\tObject.getOwnPropertyNames(source)\n\t\t\t\t.concat(Object.getOwnPropertySymbols(source))\n\t\t\t\t.forEach((property) => {\n\t\t\t\t\tif (!property.match(\n\t\t\t\t\t\t/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/\n\t\t\t\t\t)) {\n\t\t\t\t\t\tObject.defineProperty(target, property, Object.getOwnPropertyDescriptor(source, property));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t};\n\n\t\t// outside constructor() to allow Aggregation(a, b, c).staticFunction() to be called etc.\n\t\tmixins.forEach((mixin) => {\n\t\t\tcopyProperties(base.prototype, mixin.prototype);\n\t\t\tcopyProperties(base, mixin);\n\t\t});\n\n\t\treturn base;\n\t};\n\n\tclass AreaFormElement {\n\t\t/**\n\t\t * @type {string}\n\t\t */\n\t\tshape = '';\n\n\t\t/**\n\t\t * @type {Object}\n\t\t */\n\t\thtmlElements = {\n\t\t\tsubForm: '',\n\t\t\tcoordForm: ''\n\t\t};\n\n\t\t/**\n\t\t * @type {HTMLElement}\n\t\t */\n\t\tsubForm = null;\n\n\t\t/**\n\t\t * @type {HTMLElement}\n\t\t */\n\t\tcoordForm = null;\n\n\t\t/**\n\t\t * @type {AreaForm}\n\t\t */\n\t\teditorForm = null;\n\n\t\t/**\n\t\t * @type {string[]}\n\t\t */\n\t\tcolors = [\n\t\t\t'990033', 'ff3366', 'cc0033', 'ff0033', 'ff9999', 'cc3366', 'ffccff', 'cc6699', '993366', '660033',\n\t\t\t'cc3399', 'ff99cc', 'ff66cc', 'ff99ff', 'ff6699', 'cc0066', 'ff0066', 'ff3399', 'ff0099', 'ff33cc',\n\t\t\t'ff00cc', 'ff66ff', 'ff33ff', 'ff00ff', 'cc0099', '990066', 'cc66cc', 'cc33cc', 'cc99ff', 'cc66ff',\n\t\t\t'cc33ff', '993399', 'cc00cc', 'cc00ff', '9900cc', '990099', 'cc99cc', '996699', '663366', '660099',\n\t\t\t'9933cc', '660066', '9900ff', '9933ff', '9966cc', '330033', '663399', '6633cc', '6600cc', '9966ff',\n\t\t\t'330066', '6600ff', '6633ff', 'ccccff', '9999ff', '9999cc', '6666cc', '6666ff', '666699', '333366',\n\t\t\t'333399', '330099', '3300cc', '3300ff', '3333ff', '3333cc', '0066ff', '0033ff', '3366ff', '3366cc',\n\t\t\t'000066', '000033', '0000ff', '000099', '0033cc', '0000cc', '336699', '0066cc', '99ccff', '6699ff',\n\t\t\t'003366', '6699cc', '006699', '3399cc', '0099cc', '66ccff', '3399ff', '003399', '0099ff', '33ccff',\n\t\t\t'00ccff', '99ffff', '66ffff', '33ffff', '00ffff', '00cccc', '009999', '669999', '99cccc', 'ccffff',\n\t\t\t'33cccc', '66cccc', '339999', '336666', '006666', '003333', '00ffcc', '33ffcc', '33cc99', '00cc99',\n\t\t\t'66ffcc', '99ffcc', '00ff99', '339966', '006633', '336633', '669966', '66cc66', '99ff99', '66ff66',\n\t\t\t'339933', '99cc99', '66ff99', '33ff99', '33cc66', '00cc66', '66cc99', '009966', '009933', '33ff66',\n\t\t\t'00ff66', 'ccffcc', 'ccff99', '99ff66', '99ff33', '00ff33', '33ff33', '00cc33', '33cc33', '66ff33',\n\t\t\t'00ff00', '66cc33', '006600', '003300', '009900', '33ff00', '66ff00', '99ff00', '66cc00', '00cc00',\n\t\t\t'33cc00', '339900', '99cc66', '669933', '99cc33', '336600', '669900', '99cc00', 'ccff66', 'ccff33',\n\t\t\t'ccff00', '999900', 'cccc00', 'cccc33', '333300', '666600', '999933', 'cccc66', '666633', '999966',\n\t\t\t'cccc99', 'ffffcc', 'ffff99', 'ffff66', 'ffff33', 'ffff00', 'ffcc00', 'ffcc66', 'ffcc33', 'cc9933',\n\t\t\t'996600', 'cc9900', 'ff9900', 'cc6600', '993300', 'cc6633', '663300', 'ff9966', 'ff6633', 'ff9933',\n\t\t\t'ff6600', 'cc3300', '996633', '330000', '663333', '996666', 'cc9999', '993333', 'cc6666', 'ffcccc',\n\t\t\t'ff3333', 'cc3333', 'ff6666', '660000', '990000', 'cc0000', 'ff0000', 'ff3300', 'cc9966', 'ffcc99',\n\t\t\t'ffffff', 'cccccc', '999999', '666666', '333333', '000000'\n\t\t];\n\n\t\t/**\n\t\t * @type {string[]}\n\t\t */\n\t\tignoreAttributes = [\n\t\t\t'link',\n\t\t];\n\n\t\tpostAddToForm() {\n\t\t\tthis.id = fabric.Object.__uid++;\n\n\t\t\tthis.initializeValues();\n\t\t\tthis.initializeButtons();\n\t\t\tthis.initializeColorPicker();\n\t\t}\n\n\t\tinitializeHtmlElements() {\n\t\t\tfor (key of Object.keys(this.htmlElements)) {\n\t\t\t\tthis[key] = this.getFormElement(this.htmlElements[key]);\n\t\t\t}\n\t\t}\n\n\t\tinitializeValues() {\n\t\t\tthis.getElements('.t3js-field').forEach(function (field) {\n\t\t\t\tswitch (field.id) {\n\t\t\t\t\tcase 'color':\n\t\t\t\t\t\tfield.style.backgroundColor = this.color;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'right':\n\t\t\t\t\t\tfield.value = this.width + this.left;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'bottom':\n\t\t\t\t\t\tfield.value = this.height + this.top;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tfield.value = this[field.id] ? this[field.id] : '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tinitializeButtons() {\n\t\t\tthis.getElements('.t3js-btn').forEach(function (button) {\n\t\t\t\tbutton.addEventListener('click', this[button.id + 'Action'].bind(this));\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tinitializeColorPicker() {\n\t\t\tlet colorPicker = this.getElement('#colorPicker');\n\n\t\t\tthis.colors.forEach((color) => {\n\t\t\t\tlet cell = document.createElement('div');\n\t\t\t\tcell.id = color;\n\t\t\t\tcell.style.backgroundColor = '#' + color;\n\t\t\t\tcell.classList.add('colorPickerCell');\n\t\t\t\tcell.addEventListener('click', this.colorPickerAction.bind(this));\n\n\t\t\t\tcolorPicker.appendChild(cell);\n\t\t\t});\n\t\t}\n\n\t\tlinkAction(event) {\n\t\t\tthis.editorForm.openPopup(event.currentTarget, this);\n\t\t}\n\n\t\tupAction() {\n\t\t}\n\n\t\tdownAction() {\n\t\t}\n\n\t\tdeleteAction() {\n\t\t\tthis.editorForm.deleteArea(this);\n\t\t\tthis.subForm.remove();\n\t\t\tif (this.coordForm) {\n\t\t\t\tthis.coordForm.remove();\n\t\t\t}\n\t\t\tdelete this;\n\t\t}\n\n\t\texpandAction() {\n\t\t\tthis.showElement('.moreOptions');\n\t\t\tthis.hideElement('#expand');\n\t\t\tthis.showElement('#collapse');\n\t\t}\n\n\t\tcollapseAction() {\n\t\t\tthis.hideElement('.moreOptions');\n\t\t\tthis.hideElement('#collapse');\n\t\t\tthis.showElement('#expand');\n\t\t}\n\n\t\tcolorPickerAction(event) {\n\t\t\tlet color = event.currentTarget.style.backgroundColor;\n\t\t\tthis.getElement('#color').style.backgroundColor = color;\n\t\t\tthis.set('borderColor', color);\n\t\t\tthis.set('stroke', color);\n\t\t\tthis.set('fill', AreaEditor.hexToRgbA(AreaEditor.rgbAToHex(color), 0.2));\n\t\t\tthis.editorForm.editor.canvas.renderAll();\n\t\t}\n\n\t\tgetFormElement(selector) {\n\t\t\tlet template = this.editorForm.element.querySelector(selector).innerHTML;\n\t\t\ttemplate.replace(/_ID/g, this.id);\n\t\t\treturn new DOMParser().parseFromString(template, 'text/html').body.firstChild;\n\t\t}\n\n\t\tgetElement(selector) {\n\t\t\treturn this.subForm.querySelector(selector);\n\t\t}\n\n\t\tgetElements(selector) {\n\t\t\treturn this.subForm.querySelectorAll(selector);\n\t\t}\n\n\t\thideElement(selector) {\n\t\t\tthis.getElement(selector).classList.add('hide');\n\t\t}\n\n\t\tshowElement(selector) {\n\t\t\tthis.getElement(selector).classList.remove('hide');\n\t\t}\n\n\t\ttoAreaXml() {\n\t\t\treturn [\n\t\t\t\t'<area shape=\"' + this.shape + '\"',\n\t\t\t\t' coords=\"' + this.getAreaCoords() + '\"',\n\t\t\t\tthis.getAdditionalAttributes() + '>',\n\t\t\t\tthis.getLink(),\n\t\t\t\t'</area>'\n\t\t\t].join('');\n\t\t}\n\n\t\tgetAreaCoords() {\n\t\t}\n\n\t\tgetAdditionalAttributes() {\n\t\t\tlet result = [];\n\n\t\t\tthis.getElements('.t3js-field').forEach((field) => {\n\t\t\t\tif (this.ignoreAttributes.indexOf(field.id) < 0) {\n\t\t\t\t\tswitch (field.id) {\n\t\t\t\t\t\tcase 'color':\n\t\t\t\t\t\t\tresult.push(field.id + '=\"' + AreaEditor.rgbAToHex(field.style.backgroundColor) + '\"');\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tresult.push(field.id + '=\"' + field.value + '\"');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn (result.length > 0 ? ' ' : '') + result.join(' ');\n\t\t}\n\n\t\tgetLink() {\n\t\t\treturn this.getElement('#link').value;\n\t\t}\n\t}\n\n\tclass Rect extends Aggregation(fabric.Rect, AreaFormElement) {\n\t\tshape = 'rect';\n\n\t\thtmlElements = {\n\t\t\tsubForm: '#rectForm'\n\t\t};\n\n\t\tignoreAttributes = [\n\t\t\t'link',\n\t\t\t'left',\n\t\t\t'top',\n\t\t\t'right',\n\t\t\t'bottom'\n\t\t];\n\n\t\tundoAction() {\n\t\t}\n\n\t\tredoAction() {\n\t\t}\n\n\t\tgetAreaCoords() {\n\t\t\treturn [this.left, this.top, (this.left + this.width), (this.height + this.top)].join(',');\n\t\t}\n\t}\n\n\tclass Circle extends Aggregation(fabric.Circle, AreaFormElement) {\n\t\tshape = 'circle';\n\n\t\thtmlElements = {\n\t\t\tsubForm: '#circForm'\n\t\t};\n\n\t\tignoreAttributes = [\n\t\t\t'link',\n\t\t\t'left',\n\t\t\t'top',\n\t\t\t'radius'\n\t\t];\n\n\t\tundoAction() {\n\t\t}\n\n\t\tredoAction() {\n\t\t}\n\n\t\tgetAreaCoords() {\n\t\t\tlet coords = this.getCoords(),\n\t\t\t\tleft = coords[0].x + this.radius,\n\t\t\t\ttop = coords[0].y + this.radius;\n\t\t\treturn left + ',' + top + ',' + this.radius;\n\t\t}\n\t}\n\n\tclass Polygon extends Aggregation(fabric.Polygon, AreaFormElement) {\n\t\tshape = 'poly';\n\n\t\thtmlElements = {\n\t\t\tsubForm: '#polyForm',\n\t\t\tcoordForm: '#polyCoords'\n\t\t};\n\n\t\tignoreAttributes = [\n\t\t\t'link',\n\t\t\t'left',\n\t\t\t'top'\n\t\t];\n\n\t\tinitializeValues() {\n\t\t\tthis.getElements('.t3js-field').forEach(function (field) {\n\t\t\t\tswitch (field.id) {\n\t\t\t\t\tcase 'color':\n\t\t\t\t\t\tfield.style.backgroundColor = this.color;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'right':\n\t\t\t\t\t\tfield.value = this.width + this.left;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'bottom':\n\t\t\t\t\t\tfield.value = this.height + this.top;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tfield.value = this[field.id] ? this[field.id] : '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\n\t\t\t// points\n\t\t}\n\n\t\tundoAction() {\n\t\t}\n\n\t\tredoAction() {\n\t\t}\n\n\t\taddBeforeAction() {\n\t\t}\n\n\t\taddAfterAction() {\n\t\t}\n\n\t\tremoveAction() {\n\t\t}\n\n\t\tgetAreaCoords() {\n\n\t\t}\n\n\t\tgetAdditionalAttributes() {\n\t\t\tlet result = [];\n\n\t\t\tthis.getElements('.t3js-field').forEach((field) => {\n\t\t\t\tif (this.ignoreAttributes.indexOf(field.id) < 0\n\t\t\t\t\t\t|| field.id.indexOf('x') !== 0\n\t\t\t\t\t\t|| field.id.indexOf('y') !== 0) {\n\t\t\t\t\tswitch (field.id) {\n\t\t\t\t\t\tcase 'color':\n\t\t\t\t\t\t\tresult.push(field.id + '=\"' + AreaEditor.rgbAToHex(field.style.backgroundColor) + '\"');\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tresult.push(field.id + '=\"' + field.value + '\"');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn (result.length > 0 ? ' ' : '') + result.join(' ');\n\t\t}\n\t}\n\n\tclass AreaForm {\n\t\t/**\n\t\t * @type {Array}\n\t\t */\n\t\tareas = [];\n\n\t\tconstructor(formElement, editor) {\n\t\t\tthis.element = fabric.document.querySelector(formElement);\n\t\t\tthis.editor = editor;\n\t\t}\n\n\t\taddArea(area) {\n\t\t\tarea.editorForm = this;\n\t\t\tarea.initializeHtmlElements();\n\n\t\t\tthis.areas.push(area);\n\t\t\tthis.element.insertBefore(area.subForm, this.element.firstChild);\n\n\t\t\tarea.postAddToForm();\n\t\t}\n\n\t\tdeleteArea(area) {\n\t\t\tlet areas = [];\n\t\t\tthis.areas.forEach((currentArea) => {\n\t\t\t\tif (area !== currentArea) {\n\t\t\t\t\tareas.push(currentArea);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.areas = areas;\n\t\t\tthis.editor.deleteArea(area);\n\t\t}\n\n\t\topenPopup(link, area) {\n\t\t\tlink.blur();\n\n\t\t\tlet data = window.imagemap.browseLink;\n\t\t\tdata.objectId = area.id;\n\t\t\tdata.currentValue = area.getLink();\n\n\t\t\t$.ajax({\n\t\t\t\turl: TYPO3.settings.ajaxUrls['imagemap_browselink_url'],\n\t\t\t\tcontext: area,\n\t\t\t\tdata: data\n\t\t\t}).done(function (response) {\n\t\t\t\tlet vHWin = window.open(\n\t\t\t\t\tresponse.url,\n\t\t\t\t\t'',\n\t\t\t\t\t'height=600,width=500,status=0,menubar=0,scrollbars=1'\n\t\t\t\t);\n\t\t\t\tvHWin.focus()\n\t\t\t});\n\t\t}\n\n\t\ttoAreaXml() {\n\t\t\tlet xml = ['<map>'];\n\t\t\tthis.areas.forEach((area) => {\n\t\t\t\txml.push(area.toAreaXml());\n\t\t\t});\n\t\t\txml.push('</map>');\n\t\t\treturn xml.join(\"\\n\");\n\t\t}\n\t}\n\n\tclass AreaEditor {\n\t\tconstructor(canvas, form, options) {\n\t\t\tthis.preview = false;\n\t\t\tthis.initializeOptions(options);\n\n\t\t\tthis.canvas = new fabric.Canvas(canvas, options.canvas);\n\t\t\tif (!this.preview) {\n\t\t\t\tthis.editorForm = new AreaForm(form, this);\n\t\t\t}\n\t\t}\n\n\t\tinitializeOptions(options) {\n\t\t\tfor (let option in options) {\n\t\t\t\tif (options.hasOwnProperty(option)) {\n\t\t\t\t\tthis[option] = options[option];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tinitializeScaling(scaling) {\n\t\t\tlet width = parseInt(scaling) / this.canvas.width,\n\t\t\t\theight = parseInt(scaling) / this.canvas.height;\n\t\t\treturn (width > height) ? height : width;\n\t\t}\n\t\tsetScale(scaling) {\n\t\t\tthis.scaleFactor = scaling > 1 ? 1 : scaling;\n\t\t}\n\t\tgetMaxWidth() {\n\t\t\treturn this.scaleFactor * this.canvas.width;\n\t\t}\n\t\tgetMaxHeight() {\n\t\t\treturn this.scaleFactor * this.canvas.height;\n\t\t}\n\n\t\taddRect(configuration) {\n\t\t\tlet [left, top, right, bottom] = configuration.coords.split(','),\n\t\t\t\tarea = new Rect({\n\t\t\t\t\t...configuration,\n\t\t\t\t\thasRotatingPoint: false,\n\t\t\t\t\tleft: parseInt(left),\n\t\t\t\t\ttop: parseInt(top),\n\t\t\t\t\twidth: right - left,\n\t\t\t\t\theight: bottom - top,\n\t\t\t\t\tborderColor: configuration.color,\n\t\t\t\t\tstroke: configuration.color,\n\t\t\t\t\tstrokeWidth: 1,\n\t\t\t\t\tfill: AreaEditor.hexToRgbA(configuration.color, this.preview ? 0.001 : 0.2)\n\t\t\t\t});\n\n\t\t\tthis.canvas.add(area);\n\t\t\tif (this.editorForm) {\n\t\t\t\tthis.editorForm.addArea(area);\n\t\t\t}\n\t\t}\n\n\t\taddCircle(configuration) {\n\t\t\tlet [left, top, radius] = configuration.coords.split(','),\n\t\t\t\tarea = new Circle({\n\t\t\t\t\t...configuration,\n\t\t\t\t\thasRotatingPoint: false,\n\t\t\t\t\tleft: left - radius,\n\t\t\t\t\ttop: top - radius,\n\t\t\t\t\tradius: parseInt(radius),\n\t\t\t\t\tborderColor: configuration.color,\n\t\t\t\t\tstroke: configuration.color,\n\t\t\t\t\tstrokeWidth: 1,\n\t\t\t\t\tfill: AreaEditor.hexToRgbA(configuration.color, this.preview ? 0.001 : 0.2)\n\t\t\t\t});\n\n\t\t\tthis.canvas.add(area);\n\t\t\tif (this.editorForm) {\n\t\t\t\tthis.editorForm.addArea(area);\n\t\t\t}\n\t\t}\n\n\t\taddPoly(configuration) {\n\t\t\tlet coordsXY = configuration.coords.split(','),\n\t\t\t\tleft = 100000,\n\t\t\t\ttop = 100000,\n\t\t\t\ti = 0,\n\t\t\t\tpoints = [];\n\n\t\t\tif (coordsXY.length % 2) {\n\t\t\t\tthrow new Error('Bad coords count');\n\t\t\t}\n\n\t\t\tfor (; i < coordsXY.length; i = i + 2) {\n\t\t\t\tlet xy = {x: parseInt(coordsXY[i]), y: parseInt(coordsXY[i + 1])};\n\t\t\t\tpoints.push(xy);\n\n\t\t\t\tleft = Math.min(left, xy.x);\n\t\t\t\ttop = Math.min(top, xy.y);\n\t\t\t}\n\n\t\t\tlet area = new Polygon(points, {\n\t\t\t\t...configuration,\n\t\t\t\thasRotatingPoint: false,\n\t\t\t\ttop: top,\n\t\t\t\tleft: left,\n\t\t\t\tborderColor: configuration.color,\n\t\t\t\tstroke: configuration.color,\n\t\t\t\tstrokeWidth: 1,\n\t\t\t\tfill: AreaEditor.hexToRgbA(configuration.color, this.preview ? 0.001 : 0.2)\n\t\t\t});\n\n\t\t\tthis.canvas.add(area);\n\t\t\tif (this.editorForm) {\n\t\t\t\tthis.editorForm.addArea(area);\n\t\t\t}\n\t\t}\n\n\t\tstatic hexToRgbA(hex, alpha) {\n\t\t\tlet chars, r, g, b, result;\n\t\t\tif (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {\n\t\t\t\tchars = hex.substring(1).split('');\n\t\t\t\tif (chars.length === 3) {\n\t\t\t\t\tchars = [chars[0], chars[0], chars[1], chars[1], chars[2], chars[2]];\n\t\t\t\t}\n\n\t\t\t\tr = parseInt(chars[0] + chars[1], 16);\n\t\t\t\tg = parseInt(chars[2] + chars[3], 16);\n\t\t\t\tb = parseInt(chars[4] + chars[5], 16);\n\n\t\t\t\tif (alpha) {\n\t\t\t\t\tresult = 'rgba(' + [r, g, b, alpha].join(', ') + ')';\n\t\t\t\t} else {\n\t\t\t\t\tresult = 'rgb(' + [r, g, b].join(', ') + ')';\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tthrow new Error('Bad Hex');\n\t\t}\n\n\t\tstatic rgbAToHex(rgba) {\n\t\t\tlet numbers = rgba.replace(/[^0-9,]*/g, '').split(',');\n\n\t\t\tif (numbers.length < 3) {\n\t\t\t\tthrow new Error('Bad rgba');\n\t\t\t}\n\n\t\t\tlet rgb = numbers[2] | (numbers[1] << 8) | (numbers[0] << 16);\n\t\t\treturn '#' + (0x1000000 + rgb).toString(16).slice(1).toUpperCase();\n\t\t}\n\n\t\tdeleteArea(area) {\n\t\t\tthis.canvas.remove(area);\n\t\t}\n\n\t\ttoAreaXml() {\n\t\t\treturn this.editorForm.toAreaXml();\n\t\t}\n\t}\n\n\treturn AreaEditor;\n});\n"]}