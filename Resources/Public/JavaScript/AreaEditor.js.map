{"version":3,"sources":["AreaEditor.es6"],"names":["define","$","fabric","Aggregation","baseClass","mixins","base","args","forEach","mixin","copyProperties","target","source","Object","getOwnPropertyNames","concat","getOwnPropertySymbols","property","match","defineProperty","getOwnPropertyDescriptor","prototype","AreaFormElement","shape","subForm","coordForm","editorForm","initializeValues","initializeButtons","querySelectorAll","field","id","style","backgroundColor","color","value","width","left","height","top","bind","button","addEventListener","event","openPopup","currentTarget","deleteArea","remove","showElement","hideElement","selector","querySelector","getElement","classList","add","getAreaCoords","getAdditionalAttributes","getLink","join","Rect","options","__uid","result","push","AreaEditor","rgbAToHex","length","Circle","radius","Polygon","link","title","AreaForm","formElement","editor","element","document","areas","DOMParser","parseFromString","innerHTML","body","firstChild","area","getFormElement","addArea","insertBefore","postAddToForm","currentArea","blur","data","window","imagemap","browseLink","objectId","currentValue","ajax","url","TYPO3","settings","ajaxUrls","context","done","response","vHWin","open","focus","xml","toAreaXml","canvas","form","preview","initializeOptions","Canvas","option","hasOwnProperty","scaling","parseInt","scaleFactor","configuration","coords","split","right","bottom","borderColor","stroke","strokeWidth","fill","hexToRgbA","addRect","addCircle","coordsXY","i","points","Error","xy","x","y","Math","min","addPoly","hex","alpha","chars","r","g","b","test","substring","rgba","numbers","replace","rgb","toString","slice","toUpperCase"],"mappings":"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","file":"AreaEditor.js","sourcesContent":["define(['jquery', 'TYPO3/CMS/Imagemap/Fabric'], ($, fabric) => {\n\tlet Aggregation = (baseClass, ...mixins) => {\n\t\tclass base extends baseClass {\n\t\t\tconstructor (...args) {\n\t\t\t\tsuper(...args);\n\t\t\t\tmixins.forEach((mixin) => {\n\t\t\t\t\tcopyProperties(this, (new mixin));\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// this function copies all properties and symbols, filtering out some special ones\n\t\tlet copyProperties = (target, source) => {\n\t\t\tObject.getOwnPropertyNames(source)\n\t\t\t\t.concat(Object.getOwnPropertySymbols(source))\n\t\t\t\t.forEach((property) => {\n\t\t\t\t\tif (!property.match(\n\t\t\t\t\t\t/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/\n\t\t\t\t\t)) {\n\t\t\t\t\t\tObject.defineProperty(target, property, Object.getOwnPropertyDescriptor(source, property));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t};\n\n\t\t// outside constructor() to allow Aggregation(a, b, c).staticFunction() to be called etc.\n\t\tmixins.forEach((mixin) => {\n\t\t\tcopyProperties(base.prototype, mixin.prototype);\n\t\t\tcopyProperties(base, mixin);\n\t\t});\n\n\t\treturn base;\n\t};\n\n\tclass AreaFormElement {\n\t\tconstructor() {\n\t\t\tthis.shape = '';\n\t\t\tthis.subForm = null;\n\t\t\tthis.coordForm = null;\n\t\t\tthis.editorForm = null;\n\t\t}\n\n\t\tpostAddToForm() {\n\t\t\tthis.initializeValues();\n\t\t\tthis.initializeButtons();\n\t\t}\n\n\t\tinitializeValues() {\n\t\t\tthis.subForm.querySelectorAll('.t3js-field').forEach(function (field) {\n\t\t\t\tswitch (field.id) {\n\t\t\t\t\tcase 'color':\n\t\t\t\t\t\tfield.style.backgroundColor = this.color;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'right':\n\t\t\t\t\t\tfield.value = this.width + this.left;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'bottom':\n\t\t\t\t\t\tfield.value = this.height + this.top;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tfield.value = this[field.id] ? this[field.id] : '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tinitializeButtons() {\n\t\t\tthis.subForm.querySelectorAll('.t3js-btn').forEach(function (button) {\n\t\t\t\tbutton.addEventListener('click', this[button.id + 'Action'].bind(this));\n\t\t\t}.bind(this));\n\t\t}\n\n\t\tlinkAction(event) {\n\t\t\tthis.editorForm.openPopup(event.currentTarget, this);\n\t\t}\n\n\t\tupAction() {\n\t\t}\n\n\t\tdownAction() {\n\t\t}\n\n\t\tdeleteAction() {\n\t\t\tthis.editorForm.deleteArea(this);\n\t\t\tthis.subForm.remove();\n\t\t\tdelete this;\n\t\t}\n\n\t\texpandAction() {\n\t\t\tthis.showElement('.moreOptions');\n\t\t\tthis.hideElement('#expand');\n\t\t\tthis.showElement('#collapse');\n\t\t}\n\n\t\tcollapseAction() {\n\t\t\tthis.hideElement('.moreOptions');\n\t\t\tthis.hideElement('#collapse');\n\t\t\tthis.showElement('#expand');\n\t\t}\n\n\t\tgetElement(selector) {\n\t\t\treturn this.subForm.querySelector(selector);\n\t\t}\n\n\t\thideElement(selector) {\n\t\t\tthis.getElement(selector).classList.add('hide');\n\t\t}\n\n\t\tshowElement(selector) {\n\t\t\tthis.getElement(selector).classList.remove('hide');\n\t\t}\n\n\t\ttoAreaXml() {\n\t\t\treturn [\n\t\t\t\t'<area shape=\"' + this.shape + '\"',\n\t\t\t\t' coords=\"' + this.getAreaCoords() + '\"',\n\t\t\t\tthis.getAdditionalAttributes() + '>',\n\t\t\t\tthis.getLink(),\n\t\t\t\t'</area>'\n\t\t\t].join('');\n\t\t}\n\n\t\tgetAreaCoords() {\n\t\t}\n\n\t\tgetAdditionalAttributes() {\n\t\t}\n\n\t\tgetLink() {\n\t\t\treturn this.subForm.querySelector('#link').value;\n\t\t}\n\t}\n\n\tclass Rect extends Aggregation(fabric.Rect, AreaFormElement) {\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\n\t\t\tthis.shape = 'rect';\n\t\t\tthis.id = fabric.Object.__uid++;\n\t\t\tthis.editorForm = null;\n\t\t\tthis.subForm = null;\n\t\t}\n\n\t\tundoAction() {\n\t\t}\n\n\t\tredoAction() {\n\t\t}\n\n\t\tgetAreaCoords() {\n\t\t\treturn [this.left, this.top, (this.left + this.width), (this.height + this.top)].join(',');\n\t\t}\n\n\t\tgetAdditionalAttributes() {\n\t\t\tlet result = [];\n\n\t\t\tif (this.subForm.querySelector('#title').value) {\n\t\t\t\tresult.push('alt=\"' + this.subForm.querySelector('#title').value + '\"');\n\t\t\t}\n\n\t\t\tif (this.subForm.querySelector('#color')) {\n\t\t\t\tresult.push('color=\"' + AreaEditor.rgbAToHex(\n\t\t\t\t\tthis.subForm.querySelector('#color').style.backgroundColor\n\t\t\t\t) + '\"');\n\t\t\t}\n\n\t\t\treturn (result.length > 0 ? ' ' : '') + result.join(' ');\n\t\t}\n\t}\n\n\tclass Circle extends Aggregation(fabric.Circle, AreaFormElement) {\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\n\t\t\tthis.shape = 'circle';\n\t\t\tthis.id = fabric.Object.__uid++;\n\t\t\tthis.editorForm = null;\n\t\t\tthis.subForm = null;\n\t\t}\n\n\t\tundoAction() {\n\t\t}\n\n\t\tredoAction() {\n\t\t}\n\n\t\tgetAreaCoords() {\n\t\t\treturn this.left + ',' + this.top + ',' + this.radius;\n\t\t}\n\n\t\tgetAdditionalAttributes() {\n\t\t\tlet result = [];\n\n\t\t\tif (this.subForm.querySelector('#title').value) {\n\t\t\t\tresult.push('alt=\"' + this.subForm.querySelector('#title').value + '\"');\n\t\t\t}\n\n\t\t\tif (this.subForm.querySelector('#color')) {\n\t\t\t\tresult.push('color=\"' + AreaEditor.rgbAToHex(\n\t\t\t\t\tthis.subForm.querySelector('#color').style.backgroundColor\n\t\t\t\t) + '\"');\n\t\t\t}\n\n\t\t\treturn (result.length > 0 ? ' ' : '') + result.join(' ');\n\t\t}\n\t}\n\n\tclass Polygon extends Aggregation(fabric.Polygon, AreaFormElement) {\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\n\t\t\tthis.shape = 'poly';\n\t\t\tthis.id = fabric.Object.__uid++;\n\t\t\tthis.editorForm = null;\n\t\t\tthis.subForm = null;\n\t\t\tthis.coordForm = null;\n\t\t}\n\n\t\tinitializeValues() {\n\t\t\tthis.subForm.querySelector('#link').value = this.link;\n\t\t\tthis.subForm.querySelector('#title').value = this.title;\n\t\t\tthis.subForm.querySelector('#color').style.backgroundColor = this.color;\n\t\t}\n\n\t\tundoAction() {\n\t\t}\n\n\t\tredoAction() {\n\t\t}\n\n\t\tdeleteAction() {\n\t\t\tthis.editorForm.deleteArea(this);\n\t\t\tthis.subForm.remove();\n\t\t\tthis.coordForm.remove();\n\t\t\tdelete this;\n\t\t}\n\n\t\taddAction() {\n\t\t}\n\n\t\tgetAreaCoords() {\n\n\t\t}\n\n\t\tgetAdditionalAttributes() {\n\t\t\tlet result = [];\n\n\t\t\tif (this.subForm.querySelector('#title').value) {\n\t\t\t\tresult.push('alt=\"' + this.subForm.querySelector('#title').value + '\"');\n\t\t\t}\n\n\t\t\tif (this.subForm.querySelector('#color')) {\n\t\t\t\tresult.push('color=\"' + AreaEditor.rgbAToHex(\n\t\t\t\t\tthis.subForm.querySelector('#color').style.backgroundColor\n\t\t\t\t) + '\"');\n\t\t\t}\n\n\t\t\treturn (result.length > 0 ? ' ' : '') + result.join(' ');\n\t\t}\n\t}\n\n\tclass AreaForm {\n\t\tconstructor(formElement, editor) {\n\t\t\tthis.element = fabric.document.querySelector('#' + formElement);\n\t\t\tthis.editor = editor;\n\t\t\tthis.areas = [];\n\t\t}\n\n\t\tgetFormElement(selector) {\n\t\t\treturn new DOMParser().parseFromString(\n\t\t\t\tthis.element.querySelector(selector).innerHTML,\n\t\t\t\t'text/html'\n\t\t\t).body.firstChild;\n\t\t}\n\n\t\taddRect(area) {\n\t\t\tarea.subForm = this.getFormElement('#rectForm');\n\n\t\t\tthis.addArea(area);\n\t\t}\n\n\t\taddCircle(area) {\n\t\t\tarea.subForm = this.getFormElement('#circForm');\n\n\t\t\tthis.addArea(area);\n\t\t}\n\n\t\taddPoly(area) {\n\t\t\tarea.subForm = this.getFormElement('#polyForm');\n\t\t\tarea.coordForm = this.getFormElement('#polyCoords');\n\n\t\t\tthis.addArea(area);\n\t\t}\n\n\t\taddArea(area) {\n\t\t\tarea.editorForm = this;\n\t\t\tthis.areas.push(area);\n\t\t\tthis.element.insertBefore(area.subForm, this.element.firstChild);\n\n\t\t\tarea.postAddToForm();\n\t\t}\n\n\t\tdeleteArea(area) {\n\t\t\tlet areas = [];\n\t\t\tthis.areas.forEach((currentArea) => {\n\t\t\t\tif (area !== currentArea) {\n\t\t\t\t\tareas.push(currentArea);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.areas = areas;\n\t\t\tthis.editor.deleteArea(area);\n\t\t}\n\n\t\topenPopup(link, area) {\n\t\t\tlink.blur();\n\n\t\t\tlet data = window.imagemap.browseLink;\n\t\t\tdata.objectId = area.id;\n\t\t\tdata.currentValue = area.getLink();\n\n\t\t\t$.ajax({\n\t\t\t\turl: TYPO3.settings.ajaxUrls['imagemap_browselink_url'],\n\t\t\t\tcontext: area,\n\t\t\t\tdata: data\n\t\t\t}).done(function (response) {\n\t\t\t\tlet vHWin = window.open(\n\t\t\t\t\tresponse.url,\n\t\t\t\t\t'',\n\t\t\t\t\t'height=600,width=500,status=0,menubar=0,scrollbars=1'\n\t\t\t\t);\n\t\t\t\tvHWin.focus()\n\t\t\t});\n\t\t}\n\n\t\ttoAreaXml() {\n\t\t\tlet xml = ['<map>'];\n\t\t\tthis.areas.forEach((area) => {\n\t\t\t\txml.push(area.toAreaXml());\n\t\t\t});\n\t\t\txml.push('</map>');\n\t\t\treturn xml.join(\"\\n\");\n\t\t}\n\t}\n\n\tclass AreaEditor {\n\t\tconstructor(canvas, form, options) {\n\t\t\tthis.preview = false;\n\t\t\tthis.initializeOptions(options);\n\n\t\t\tthis.canvas = new fabric.Canvas(canvas, options.canvas);\n\t\t\tif (!this.preview) {\n\t\t\t\tthis.editorForm = new AreaForm(form, this);\n\t\t\t}\n\t\t}\n\n\t\tinitializeOptions(options) {\n\t\t\tfor (let option in options) {\n\t\t\t\tif (options.hasOwnProperty(option)) {\n\t\t\t\t\tthis[option] = options[option];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tinitializeScaling(scaling) {\n\t\t\tlet width = parseInt(scaling) / this.canvas.width,\n\t\t\t\theight = parseInt(scaling) / this.canvas.height;\n\t\t\treturn (width > height) ? height : width;\n\t\t}\n\t\tsetScale(scaling) {\n\t\t\tthis.scaleFactor = scaling > 1 ? 1 : scaling;\n\t\t}\n\t\tgetMaxWidth() {\n\t\t\treturn this.scaleFactor * this.canvas.width;\n\t\t}\n\t\tgetMaxHeight() {\n\t\t\treturn this.scaleFactor * this.canvas.height;\n\t\t}\n\n\t\taddRect(configuration) {\n\t\t\tlet [left, top, right, bottom] = configuration.coords.split(','),\n\t\t\t\tarea = new Rect({\n\t\t\t\t\t...configuration,\n\t\t\t\t\tleft: parseInt(left),\n\t\t\t\t\ttop: parseInt(top),\n\t\t\t\t\twidth: right - left,\n\t\t\t\t\theight: bottom - top,\n\t\t\t\t\tborderColor: configuration.color,\n\t\t\t\t\tstroke: configuration.color,\n\t\t\t\t\tstrokeWidth: 1,\n\t\t\t\t\tfill: AreaEditor.hexToRgbA(configuration.color, this.preview ? 0.001 : 0.2)\n\t\t\t\t});\n\n\t\t\tthis.canvas.add(area);\n\t\t\tif (this.editorForm) {\n\t\t\t\tthis.editorForm.addRect(area);\n\t\t\t}\n\t\t}\n\n\t\taddCircle(configuration) {\n\t\t\tlet [left, top, radius] = configuration.coords.split(','),\n\t\t\t\tarea = new Circle({\n\t\t\t\t\t...configuration,\n\t\t\t\t\tleft: parseInt(left),\n\t\t\t\t\ttop: parseInt(top),\n\t\t\t\t\tradius: parseInt(radius),\n\t\t\t\t\tborderColor: configuration.color,\n\t\t\t\t\tstroke: configuration.color,\n\t\t\t\t\tstrokeWidth: 1,\n\t\t\t\t\tfill: AreaEditor.hexToRgbA(configuration.color, this.preview ? 0.001 : 0.2)\n\t\t\t\t});\n\n\t\t\tthis.canvas.add(area);\n\t\t\tif (this.editorForm) {\n\t\t\t\tthis.editorForm.addCircle(area);\n\t\t\t}\n\t\t}\n\n\t\taddPoly(configuration) {\n\t\t\tlet coordsXY = configuration.coords.split(','),\n\t\t\t\tleft = 100000,\n\t\t\t\ttop = 100000,\n\t\t\t\ti = 0,\n\t\t\t\tpoints = [];\n\n\t\t\tif (coordsXY.length % 2) {\n\t\t\t\tthrow new Error('Bad coords count');\n\t\t\t}\n\n\t\t\tfor (; i < coordsXY.length; i = i + 2) {\n\t\t\t\tlet xy = {x: parseInt(coordsXY[i]), y: parseInt(coordsXY[i + 1])};\n\t\t\t\tpoints.push(xy);\n\n\t\t\t\tleft = Math.min(left, xy.x);\n\t\t\t\ttop = Math.min(top, xy.y);\n\t\t\t}\n\n\t\t\tlet area = new Polygon(points, {\n\t\t\t\t...configuration,\n\t\t\t\ttop: top,\n\t\t\t\tleft: left,\n\t\t\t\tborderColor: configuration.color,\n\t\t\t\tstroke: configuration.color,\n\t\t\t\tstrokeWidth: 1,\n\t\t\t\tfill: AreaEditor.hexToRgbA(configuration.color, this.preview ? 0.001 : 0.2)\n\t\t\t});\n\n\t\t\tthis.canvas.add(area);\n\t\t\tif (this.editorForm) {\n\t\t\t\tthis.editorForm.addPoly(area);\n\t\t\t}\n\t\t}\n\n\t\tstatic hexToRgbA(hex, alpha) {\n\t\t\tlet chars, r, g, b, result;\n\t\t\tif (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {\n\t\t\t\tchars = hex.substring(1).split('');\n\t\t\t\tif (chars.length === 3) {\n\t\t\t\t\tchars = [chars[0], chars[0], chars[1], chars[1], chars[2], chars[2]];\n\t\t\t\t}\n\n\t\t\t\tr = parseInt(chars[0] + chars[1], 16);\n\t\t\t\tg = parseInt(chars[2] + chars[3], 16);\n\t\t\t\tb = parseInt(chars[4] + chars[5], 16);\n\n\t\t\t\tif (alpha) {\n\t\t\t\t\tresult = 'rgba(' + [r, g, b, alpha].join(', ') + ')';\n\t\t\t\t} else {\n\t\t\t\t\tresult = 'rgb(' + [r, g, b].join(', ') + ')';\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tthrow new Error('Bad Hex');\n\t\t}\n\n\t\tstatic rgbAToHex(rgba) {\n\t\t\tlet numbers = rgba.replace(/[^0-9,]*/g, '').split(',');\n\n\t\t\tif (numbers.length < 3) {\n\t\t\t\tthrow new Error('Bad rgba');\n\t\t\t}\n\n\t\t\tlet rgb = numbers[2] | (numbers[1] << 8) | (numbers[0] << 16);\n\t\t\treturn '#' + (0x1000000 + rgb).toString(16).slice(1).toUpperCase();\n\t\t}\n\n\t\tdeleteArea(area) {\n\t\t\tthis.canvas.remove(area);\n\t\t}\n\n\t\ttoAreaXml() {\n\t\t\treturn this.editorForm.toAreaXml();\n\t\t}\n\t}\n\n\treturn AreaEditor;\n});\n"]}