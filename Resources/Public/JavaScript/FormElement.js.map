{"version":3,"sources":["FormElement.es6"],"names":["define","$","AreaEditor","FormElement","control","image","find","canvas","initialize","editorOptions","width","parseInt","css","height","top","previewRerenderAjaxUrl","window","TYPO3","settings","ajaxUrls","imagemap_preview_rerender","initializeAreaEditor","initializeEvents","initializeScaleFactor","data","initializeAreas","areaEditor","document","scaleFactor","setScale","on","imagemapChangedHandler","bind","areas","event","$field","currentTarget","ajax","url","method","P","itemFormElName","attr","tableName","fieldName","uid","value","val","done","textStatus","removeAllAreas"],"mappings":"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","file":"FormElement.js","sourcesContent":["define([\n\t'jquery',\n\t'./AreaEditor'\n], ($, AreaEditor) => {\n\t'use strict';\n\n\tclass FormElement {\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\tcontrol = null;\n\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\timage = null;\n\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\tcanvas = null;\n\n\t\t/**\n\t\t * @type {object}\n\t\t */\n\t\teditorOptions = {};\n\n\t\t/**\n\t\t * @type {AreaEditor}\n\t\t */\n\t\tareaEditor = null;\n\n\t\tconstructor() {\n\t\t\tthis.control = $('.imagemap-control:eq(0)');\n\t\t\tthis.image = this.control.find('.image img');\n\t\t\tthis.canvas = this.control.find('.picture');\n\n\t\t\tthis.initialize();\n\t\t}\n\n\t\tinitialize() {\n\t\t\tthis.editorOptions = {\n\t\t\t\tcanvas: {\n\t\t\t\t\twidth: parseInt(this.image.css('width')),\n\t\t\t\t\theight: parseInt(this.image.css('height')),\n\t\t\t\t\ttop: parseInt(this.image.css('height')) * -1,\n\t\t\t\t},\n\t\t\t\tpreviewRerenderAjaxUrl: window.TYPO3.settings.ajaxUrls.imagemap_preview_rerender\n\t\t\t};\n\n\t\t\tthis.initializeAreaEditor(this.editorOptions);\n\t\t\tthis.initializeEvents(this.editorOptions);\n\t\t\tthis.initializeScaleFactor(this.canvas.data('thumbnail-scale'));\n\t\t\tthis.initializeAreas(this.canvas.data('existing-areas'));\n\t\t}\n\n\t\tinitializeAreaEditor(editorOptions) {\n\t\t\tthis.areaEditor = new AreaEditor(editorOptions, this.control.find('#canvas')[0], '', window.document);\n\t\t}\n\n\t\tinitializeScaleFactor(scaleFactor) {\n\t\t\tthis.areaEditor.setScale(scaleFactor);\n\t\t}\n\n\t\tinitializeEvents() {\n\t\t\tthis.control.find('input[type=hidden]').on('imagemap:changed', this.imagemapChangedHandler.bind(this));\n\t\t}\n\n\t\tinitializeAreas(areas) {\n\t\t\tthis.areaEditor.initializeAreas(areas);\n\t\t}\n\n\t\timagemapChangedHandler(event) {\n\t\t\tlet $field = $(event.currentTarget);\n\t\t\t$.ajax({\n\t\t\t\turl: this.editorOptions.previewRerenderAjaxUrl,\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdata: {\n\t\t\t\t\tP: {\n\t\t\t\t\t\titemFormElName: $field.attr('name'),\n\t\t\t\t\t\ttableName: $field.data('tablename'),\n\t\t\t\t\t\tfieldName: $field.data('fieldname'),\n\t\t\t\t\t\tuid: $field.data('uid'),\n\t\t\t\t\t\tvalue: $field.val()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).done((data, textStatus) => {\n\t\t\t\tif (textStatus === 'success') {\n\t\t\t\t\tthis.control.find('.modifiedState').css('display', 'block');\n\t\t\t\t\tthis.areaEditor.removeAllAreas();\n\t\t\t\t\tthis.areaEditor.initializeAreas(data);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\treturn FormElement;\n});\n"]}