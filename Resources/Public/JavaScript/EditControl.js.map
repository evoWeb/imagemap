{"version":3,"sources":["EditControl.es6"],"names":["define","$","Icons","Modal","AreaEditor","EditControl","_classCallCheck","this","_defineProperty","initializeTrigger","_createClass","key","value","off","on","triggerHandler","bind","event","preventDefault","trigger","currentTarget","show","_this","modalTitle","data","buttonAddrectText","buttonAddcircleText","buttonAddpolyText","buttonSubmitText","wizardUri","payload","initWizardModal","init","getIcon","sizes","default","markupIdentifiers","inline","done","icon","currentModal","advanced","additionalCssClasses","buttons","btnClass","dataAttributes","method","text","callback","post","url","response","find","html","content","append","size","full","style","styles","dark","title","destroy","options","backdrop","$image","$canvas","configuration","editorOptions","canvas","width","parseInt","css","height","top","browseLinkUrlAjaxUrl","window","TYPO3","settings","ajaxUrls","imagemap_browselink_url","areaEditor","scaleFactor","$magnify","$zoomOut","$zoomIn","setScale","removeClass","click","hide","addRect","coords","addCircle","addPoly","opener","itemName","val","toAreaXml","close","initializeAreas","existingAreas"],"mappings":"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","file":"EditControl.js","sourcesContent":["define([\n\t'jquery',\n\t'TYPO3/CMS/Backend/Icons',\n\t'TYPO3/CMS/Backend/Modal',\n\t'./AreaEditor',\n\t'jquery-ui/draggable',\n\t'jquery-ui/resizable'\n], ($, Icons, Modal, AreaEditor) => {\n\t'use strict';\n\n\tclass EditControl {\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\ttrigger = null;\n\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\tcurrentModal = null;\n\n\t\t/**\n\t\t * @type {AreaEditor}\n\t\t */\n\t\tareaEditor = null;\n\n\t\tconstructor() {\n\t\t\tthis.initializeTrigger();\n\t\t}\n\n\t\tinitializeTrigger() {\n\t\t\t$('.t3js-area-wizard-trigger').off('click').on('click', this.triggerHandler.bind(this));\n\t\t}\n\n\t\ttriggerHandler(event) {\n\t\t\tevent.preventDefault();\n\t\t\tthis.trigger = $(event.currentTarget);\n\t\t\tthis.show();\n\t\t}\n\n\t\tshow() {\n\t\t\tlet modalTitle = this.trigger.data('modalTitle'),\n\t\t\t\tbuttonAddrectText = this.trigger.data('buttonAddrectText'),\n\t\t\t\tbuttonAddcircleText = this.trigger.data('buttonAddcircleText'),\n\t\t\t\tbuttonAddpolyText = this.trigger.data('buttonAddpolyText'),\n\t\t\t\tbuttonSubmitText = this.trigger.data('buttonSubmitText'),\n\t\t\t\twizardUri = this.trigger.data('url'),\n\t\t\t\tpayload = this.trigger.data('payload'),\n\t\t\t\tinitWizardModal = this.init.bind(this);\n\n\t\t\tIcons.getIcon('spinner-circle', Icons.sizes.default, null, null, Icons.markupIdentifiers.inline).done((icon) => {\n\t\t\t\t/**\n\t\t\t\t * Open modal with areas to edit\n\t\t\t\t */\n\t\t\t\tthis.currentModal = Modal.advanced({\n\t\t\t\t\tadditionalCssClasses: ['modal-area-wizard'],\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbtnClass: 'btn-default pull-left',\n\t\t\t\t\t\t\tdataAttributes: {\n\t\t\t\t\t\t\t\tmethod: 'addRect',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ticon: 'extensions-imagemap-rect',\n\t\t\t\t\t\t\ttext: buttonAddrectText,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbtnClass: 'btn-default pull-left',\n\t\t\t\t\t\t\tdataAttributes: {\n\t\t\t\t\t\t\t\tmethod: 'addCircle',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ticon: 'extensions-imagemap-circle',\n\t\t\t\t\t\t\ttext: buttonAddcircleText,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbtnClass: 'btn-default pull-left',\n\t\t\t\t\t\t\tdataAttributes: {\n\t\t\t\t\t\t\t\tmethod: 'addPoly',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ticon: 'extensions-imagemap-poly',\n\t\t\t\t\t\t\ttext: buttonAddpolyText,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbtnClass: 'btn-primary',\n\t\t\t\t\t\t\tdataAttributes: {\n\t\t\t\t\t\t\t\tmethod: 'save',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ticon: 'actions-document-save',\n\t\t\t\t\t\t\ttext: buttonSubmitText,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tcallback: (currentModal) => {\n\t\t\t\t\t\t$.post({\n\t\t\t\t\t\t\turl: wizardUri,\n\t\t\t\t\t\t\tdata: payload\n\t\t\t\t\t\t}).done((response) => {\n\t\t\t\t\t\t\tcurrentModal.find('.t3js-modal-body').html(response);\n\t\t\t\t\t\t\tinitWizardModal();\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tcontent: $('<div class=\"modal-loading\">').append(icon),\n\t\t\t\t\tsize: Modal.sizes.full,\n\t\t\t\t\tstyle: Modal.styles.dark,\n\t\t\t\t\ttitle: modalTitle,\n\t\t\t\t});\n\n\t\t\t\tthis.currentModal.on('hide.bs.modal', () => {\n\t\t\t\t\tthis.destroy();\n\t\t\t\t});\n\t\t\t\t// do not dismiss the modal when clicking beside it to avoid data loss\n\t\t\t\tthis.currentModal.data('bs.modal').options.backdrop = 'static';\n\t\t\t});\n\t\t}\n\n\t\tinit() {\n\t\t\tlet $image = $('.modal-panel-main .image img'),\n\t\t\t\t$canvas = $('.modal-panel-main .picture'),\n\t\t\t\tconfiguration = $canvas.data('configuration'),\n\t\t\t\teditorOptions = {\n\t\t\t\t\tcanvas: {\n\t\t\t\t\t\twidth: parseInt($image.css('width')),\n\t\t\t\t\t\theight: parseInt($image.css('height')),\n\t\t\t\t\t\ttop: parseInt($image.css('height')) * -1,\n\t\t\t\t\t},\n\t\t\t\t\tbrowseLinkUrlAjaxUrl: window.TYPO3.settings.ajaxUrls.imagemap_browselink_url\n\t\t\t\t};\n\n\t\t\tlet areaEditor = new AreaEditor(editorOptions, 'modal-canvas', '#areasForm');\n\n\t\t\tthis.areaEditor = areaEditor;\n\n\t\t\tlet initializeScaleFactor = (scaleFactor) => {\n\t\t\t\tlet $magnify = $('#magnify'),\n\t\t\t\t\t$zoomOut = $magnify.find('.zoomout'),\n\t\t\t\t\t$zoomIn = $magnify.find('.zoomin');\n\n\t\t\t\tareaEditor.setScale();\n\n\t\t\t\tif (scaleFactor < 1) {\n\t\t\t\t\t$zoomIn.removeClass('hide');\n\n\t\t\t\t\t$zoomIn.click(() => {\n\t\t\t\t\t\tareaEditor.setScale(1);\n\t\t\t\t\t\t$zoomIn.hide();\n\t\t\t\t\t\t$zoomOut.show();\n\t\t\t\t\t});\n\n\t\t\t\t\t$zoomOut.click(() => {\n\t\t\t\t\t\tareaEditor.setScale(scaleFactor);\n\t\t\t\t\t\t$zoomOut.hide();\n\t\t\t\t\t\t$zoomIn.show();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tlet initializeEvents = () => {\n\t\t\t\t$('#addRect').on('click', () => {\n\t\t\t\t\tareaEditor.addRect({\n\t\t\t\t\t\tcoords: (parseInt($image.css('width')) / 2 - 50) + ',' + (parseInt($image.css('height')) / 2 - 50)\n\t\t\t\t\t\t\t+ ',' + (parseInt($image.css('width')) / 2 + 50) + ',' + (parseInt($image.css('height')) / 2 + 50),\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\t$('#addCircle').on('click', () => {\n\t\t\t\t\tareaEditor.addCircle({\n\t\t\t\t\t\tcoords: (parseInt($image.css('width')) / 2 - 50) + ',' + (parseInt($image.css('height')) / 2 - 50) + ',50',\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\t$('#addPoly').on('click', () => {\n\t\t\t\t\tareaEditor.addPoly({\n\t\t\t\t\t\tcoords: (parseInt($image.css('width')) / 2) + ',' + (parseInt($image.css('height')) / 2 - 50)\n\t\t\t\t\t\t\t+ ',' + (parseInt($image.css('width')) / 2 + 50) + ',' + (parseInt($image.css('height')) / 2 + 50)\n\t\t\t\t\t\t\t+ ',' + (parseInt($image.css('width')) / 2) + ',' + (parseInt($image.css('height')) / 2 + 70)\n\t\t\t\t\t\t\t+ ',' + (parseInt($image.css('width')) / 2 - 50) + ',' + (parseInt($image.css('height')) / 2 + 50)\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\t$('#submit').on('click', () => {\n\t\t\t\t\twindow.opener.$('input[name=\"' + configuration.itemName + '\"]')\n\t\t\t\t\t\t.val(areaEditor.toAreaXml())\n\t\t\t\t\t\t.trigger('imagemap:changed');\n\t\t\t\t\tclose();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tinitializeScaleFactor($canvas.data('scale-factor'));\n\t\t\tinitializeEvents();\n\t\t\tareaEditor.initializeAreas(configuration.existingAreas);\n\t\t}\n\n\t\tdestroy() {\n\t\t\tif (this.currentModal) {\n\t\t\t\tthis.currentModal = null;\n\t\t\t\tthis.data = null;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn EditControl;\n});\n"]}