{"version":3,"sources":["EditControl.es6"],"names":["define","$","Icons","Modal","AreaEditor","FormEngineValidation","EditControl","initializeTrigger","off","on","triggerHandler","bind","event","preventDefault","trigger","currentTarget","show","modalTitle","data","buttonAddrectText","buttonAddcircleText","buttonAddpolyText","buttonDismissText","buttonSaveText","wizardUri","payload","initWizardModal","initialize","getIcon","sizes","default","markupIdentifiers","inline","done","icon","currentModal","advanced","additionalCssClasses","buttons","btnClass","text","callback","post","url","response","find","html","addClass","content","append","size","full","style","styles","dark","title","destroy","options","backdrop","image","configuration","buttonAddRect","buttonAddRectHandler","buttonAddCircle","buttonAddCircleHandler","buttonAddPoly","buttonAddPolyHandler","buttonDismiss","buttonDismissHandler","buttonSave","buttonSaveHandler","setTimeout","initializeArea","scaleFactor","width","parseInt","css","height","editorOptions","fauxFormDocument","document","canvas","top","browseLinkUrlAjaxUrl","window","TYPO3","settings","ajaxUrls","imagemap_browselink_url","browseLink","areaEditor","imagemap","setScale","that","$magnify","$zoomOut","$zoomIn","removeClass","click","hide","initializeAreas","existingAreas","stopPropagation","addRect","coords","addCircle","addPoly","modal","hiddenField","itemName","val","toAreaXml","markFieldAsChanged"],"mappings":"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","file":"EditControl.js","sourcesContent":["define([\n\t'jquery',\n\t'TYPO3/CMS/Backend/Icons',\n\t'TYPO3/CMS/Backend/Modal',\n\t'./AreaEditor',\n\t'TYPO3/CMS/Backend/FormEngineValidation'\n], ($, Icons, Modal, AreaEditor, FormEngineValidation) => {\n\t'use strict';\n\n\tclass EditControl {\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\ttrigger = null;\n\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\tcurrentModal = null;\n\n\t\t/**\n\t\t * @type {AreaEditor}\n\t\t */\n\t\tareaEditor = null;\n\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\timage = null;\n\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\tbuttonAddRect = null;\n\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\tbuttonAddCircle = null;\n\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\tbuttonAddPoly = null;\n\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\tbuttonDismiss = null;\n\n\t\t/**\n\t\t * @type {jQuery}\n\t\t */\n\t\tbuttonSave = null;\n\n\t\t/**\n\t\t * @type {object}\n\t\t */\n\t\tconfiguration = null;\n\n\t\tconstructor() {\n\t\t\tthis.initializeTrigger();\n\t\t}\n\n\t\tinitializeTrigger() {\n\t\t\t$('.t3js-area-wizard-trigger').off('click').on('click', this.triggerHandler.bind(this));\n\t\t}\n\n\t\ttriggerHandler(event) {\n\t\t\tevent.preventDefault();\n\t\t\tthis.trigger = $(event.currentTarget);\n\t\t\tthis.show();\n\t\t}\n\n\t\tshow() {\n\t\t\tlet modalTitle = this.trigger.data('modalTitle'),\n\t\t\t\tbuttonAddrectText = this.trigger.data('buttonAddrectText'),\n\t\t\t\tbuttonAddcircleText = this.trigger.data('buttonAddcircleText'),\n\t\t\t\tbuttonAddpolyText = this.trigger.data('buttonAddpolyText'),\n\t\t\t\tbuttonDismissText = this.trigger.data('buttonDismissText'),\n\t\t\t\tbuttonSaveText = this.trigger.data('buttonSaveText'),\n\t\t\t\twizardUri = this.trigger.data('url'),\n\t\t\t\tpayload = this.trigger.data('payload'),\n\t\t\t\tinitWizardModal = this.initialize.bind(this);\n\n\t\t\tIcons.getIcon('spinner-circle', Icons.sizes.default, null, null, Icons.markupIdentifiers.inline).done((icon) => {\n\t\t\t\t/**\n\t\t\t\t * Open modal with areas to edit\n\t\t\t\t */\n\t\t\t\tthis.currentModal = Modal.advanced({\n\t\t\t\t\tadditionalCssClasses: ['modal-area-wizard'],\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbtnClass: 'btn-default pull-left button-add-rect',\n\t\t\t\t\t\t\ticon: 'extensions-imagemap-rect',\n\t\t\t\t\t\t\ttext: buttonAddrectText,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbtnClass: 'btn-default pull-left button-add-circle',\n\t\t\t\t\t\t\ticon: 'extensions-imagemap-circle',\n\t\t\t\t\t\t\ttext: buttonAddcircleText,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbtnClass: 'btn-default pull-left button-add-poly',\n\t\t\t\t\t\t\ticon: 'extensions-imagemap-poly',\n\t\t\t\t\t\t\ttext: buttonAddpolyText,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbtnClass: 'btn-default button-dismiss',\n\t\t\t\t\t\t\ticon: 'actions-close',\n\t\t\t\t\t\t\ttext: buttonDismissText,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbtnClass: 'btn-primary button-save',\n\t\t\t\t\t\t\ticon: 'actions-document-save',\n\t\t\t\t\t\t\ttext: buttonSaveText,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tcallback: (currentModal) => {\n\t\t\t\t\t\t$.post({\n\t\t\t\t\t\t\turl: wizardUri,\n\t\t\t\t\t\t\tdata: payload\n\t\t\t\t\t\t}).done((response) => {\n\t\t\t\t\t\t\tcurrentModal.find('.t3js-modal-body').html(response).addClass('area-editor');\n\t\t\t\t\t\t\tinitWizardModal();\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tcontent: $('<div class=\"modal-loading\">').append(icon),\n\t\t\t\t\tsize: Modal.sizes.full,\n\t\t\t\t\tstyle: Modal.styles.dark,\n\t\t\t\t\ttitle: modalTitle,\n\t\t\t\t});\n\n\t\t\t\tthis.currentModal.on('hide.bs.modal', () => {\n\t\t\t\t\tthis.destroy();\n\t\t\t\t});\n\t\t\t\t// do not dismiss the modal when clicking beside it to avoid data loss\n\t\t\t\tthis.currentModal.data('bs.modal').options.backdrop = 'static';\n\t\t\t});\n\t\t}\n\n\t\tinitialize() {\n\t\t\tthis.image = this.currentModal.find('.image img');\n\t\t\tthis.configuration = this.currentModal.find('.picture').data('configuration');\n\t\t\tthis.buttonAddRect = this.currentModal.find('.button-add-rect').off('click').on('click', this.buttonAddRectHandler.bind(this));\n\t\t\tthis.buttonAddCircle = this.currentModal.find('.button-add-circle').off('click').on('click', this.buttonAddCircleHandler.bind(this));\n\t\t\tthis.buttonAddPoly = this.currentModal.find('.button-add-poly').off('click').on('click', this.buttonAddPolyHandler.bind(this));\n\t\t\tthis.buttonDismiss = this.currentModal.find('.button-dismiss').off('click').on('click', this.buttonDismissHandler.bind(this));\n\t\t\tthis.buttonSave = this.currentModal.find('.button-save').off('click').on('click', this.buttonSaveHandler.bind(this));\n\n\t\t\tthis.image.on('load', () => {\n\t\t\t\tsetTimeout(this.initializeArea.bind(this), 100);\n\t\t\t});\n\t\t}\n\n\t\tinitializeArea() {\n\t\t\tlet scaleFactor = this.currentModal.find('.picture').data('scale-factor'),\n\t\t\t\twidth = parseInt(this.image.css('width')),\n\t\t\t\theight = parseInt(this.image.css('height')),\n\t\t\t\teditorOptions = {\n\t\t\t\t\tfauxFormDocument: document,\n\t\t\t\t\tcanvas: {\n\t\t\t\t\t\twidth: width,\n\t\t\t\t\t\theight: height,\n\t\t\t\t\t\ttop: height * -1,\n\t\t\t\t\t},\n\t\t\t\t\tbrowseLinkUrlAjaxUrl: window.TYPO3.settings.ajaxUrls.imagemap_browselink_url,\n\t\t\t\t\tbrowseLink: this.configuration.browseLink\n\t\t\t\t};\n\n\t\t\tlet canvas = this.currentModal.find('#modal-canvas')[0];\n\t\t\tthis.areaEditor = new AreaEditor(editorOptions, canvas, '#areasForm', this.currentModal[0]);\n\n\t\t\twindow.imagemap = { areaEditor: this.areaEditor };\n\n\t\t\t((scaleFactor) => {\n\t\t\t\tthis.areaEditor.setScale(scaleFactor);\n\n\t\t\t\tlet that = this,\n\t\t\t\t\t$magnify = $('#magnify'),\n\t\t\t\t\t$zoomOut = $magnify.find('.zoomout'),\n\t\t\t\t\t$zoomIn = $magnify.find('.zoomin');\n\n\t\t\t\tif (scaleFactor < 1) {\n\t\t\t\t\t$zoomIn.removeClass('hide');\n\n\t\t\t\t\t$zoomIn.click(() => {\n\t\t\t\t\t\tthat.areaEditor.setScale(1);\n\t\t\t\t\t\t$zoomIn.hide();\n\t\t\t\t\t\t$zoomOut.show();\n\t\t\t\t\t});\n\n\t\t\t\t\t$zoomOut.click(() => {\n\t\t\t\t\t\tthat.areaEditor.setScale(scaleFactor);\n\t\t\t\t\t\t$zoomOut.hide();\n\t\t\t\t\t\t$zoomIn.show();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})(scaleFactor);\n\n\t\t\tthis.areaEditor.initializeAreas(this.configuration.existingAreas);\n\t\t}\n\n\t\tdestroy() {\n\t\t\tif (this.currentModal) {\n\t\t\t\tthis.currentModal = null;\n\t\t\t\tthis.areaEditor = null;\n\t\t\t}\n\t\t}\n\n\t\tbuttonAddRectHandler(event) {\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\n\t\t\tlet width = parseInt(this.image.css('width')),\n\t\t\t\theight = parseInt(this.image.css('height'));\n\n\t\t\tthis.areaEditor.addRect({\n\t\t\t\tcoords: (width / 2 - 50) + ',' + (height / 2 - 50) + ',' + (width / 2 + 50) + ',' + (height / 2 + 50),\n\t\t\t});\n\t\t}\n\n\t\tbuttonAddCircleHandler(event) {\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\n\t\t\tlet width = parseInt(this.image.css('width')),\n\t\t\t\theight = parseInt(this.image.css('height'));\n\n\t\t\tthis.areaEditor.addCircle({\n\t\t\t\tcoords: (width / 2) + ',' + (height / 2) + ',50',\n\t\t\t});\n\t\t}\n\n\t\tbuttonAddPolyHandler(event) {\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\n\t\t\tlet width = parseInt(this.image.css('width')),\n\t\t\t\theight = parseInt(this.image.css('height'));\n\n\t\t\tthis.areaEditor.addPoly({\n\t\t\t\tcoords: (width / 2) + ',' + (height / 2 - 50)\n\t\t\t\t\t+ ',' + (width / 2 + 50) + ',' + (height / 2 + 50)\n\t\t\t\t\t+ ',' + (width / 2) + ',' + (height / 2 + 70)\n\t\t\t\t\t+ ',' + (width / 2 - 50) + ',' + (height / 2 + 50)\n\t\t\t});\n\t\t}\n\n\t\tbuttonDismissHandler(event) {\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\n\t\t\tthis.currentModal.modal('hide');\n\t\t}\n\n\t\tbuttonSaveHandler(event) {\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\n\t\t\tconst hiddenField = $(`input[name=\"${this.configuration.itemName}\"]`);\n\t\t\thiddenField.val(this.areaEditor.toAreaXml()).trigger('imagemap:changed');\n\t\t\tFormEngineValidation.markFieldAsChanged(hiddenField);\n\t\t\tthis.currentModal.modal('hide');\n\t\t}\n\t}\n\n\treturn EditControl;\n});\n"]}